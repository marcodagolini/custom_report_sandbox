<!DOCTYPE html>












<head>
  
</head>


<html>
<style>
	
body{
  margin: 20px;	
}
.grid-container-header {
  display: grid;
  grid-template-columns: 180px 140px 140px 140px 140px 140px;
  width: 880px;
  background-color: #2196F3;
  padding: 5px;
}
.grid-container-closed {
  display: grid;
  grid-template-columns: 180px 140px 140px 140px 140px 140px;
  width: 880px;
  background-color: #ff0000;
  padding: 5px;
}
.grid-container-open {
  display: grid;
  grid-template-columns: 180px 140px 140px 140px 140px 140px;
  width: 880px;
  background-color: #00ff00;
  padding: 5px;
}
.grid-item {
  background-color: rgba(255, 255, 255, 0.8);
  border: 0px solid rgba(0, 0, 0, 0.8);
  padding: 0px;
  font-size: 20px;
  text-align: center;
}
.grid-item-left {
  background-color: rgba(255, 255, 255, 0.8);
  border: 0px solid rgba(0, 0, 0, 0.8);
  padding: 0px;
  font-size: 20px;
  text-align: right;
}
	
.bar-container {
  display: grid;
  grid-template-columns: auto auto auto auto auto;
  background-color: #2196F3;
  padding: 5px;
}
.bar-item {
  background-color: rgba(255, 255, 255, 0.8);
  border: 0px solid rgba(0, 0, 0, 0.8);
  padding: 0px;
  font-size: 20px;
  text-align: center;
}
.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
}
	
/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}   
  
input[type=text], input[type=password] {
    width: 200px;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    box-sizing: border-box;
}
button {
    background-color: #f68a1f;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 4px;
    cursor: pointer;
	  border-radius: 4px;
	  -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
	  font-family: "Myriad pro","Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif;
}
button:hover {
    background-color: #da7009;
    color: white;	
}
	
.cancelbtn {
    width: auto;
    padding: 10px 18px;
    background-color: #f44336;
}
.imgcontainer {
    text-align: center;
    margin: 24px 0 12px 0;
}
img.avatar {
    width: 40%;
    border-radius: 50%;
}
	
.label {
    color: black;
    width: 120px;
    height: 50px;
    padding: 6px;
    display: block;
    float:left;
    vertical-align: middle;
}
	
.loginelement {
    width: 130px;
    height: 50px;
    vertical-align: middle;
    line-height: 50px;
    float: left;
}
.container {
    padding: 16px;
}
span.psw {
    float: right;
    padding-top: 16px;
}
/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
    span.psw {
       display: block;
       float: none;
    }
    .cancelbtn {
       width: 100%;
    }
}
</style>
<body>
  
  <div id="myloader" style="display:none;">
    	<h2>Loading your page...</h2>
    	<div class="loader"></div>
  </div>
    




  <div id="mylogin" style="display:none;">
    
    <h2>Report Login</h2>
        <div class="loginelement"><b>Account Number</b></div>
	<input id="accnumb" type="text" placeholder="Enter Account Number">
	</br>
	
	<div class="loginelement"><b>Username</b></div>
        <input id="uname" type="text" placeholder="Enter Username">
	</br>
        
	<div class="loginelement"><b>Password</b></div>
        <input id="pwd" type="password" placeholder="Enter Password">
	</br>
        
    <button id="submitLogin" >Login</button>
    
    </br></br></br></br>

  <div id="sendStat"></div>

</div>


<div id="myreports" style="display:none;">
	
    
    </br>
    <button type="button" id ="logout" class="logout" style="float: right;">Log Out</button>

    <div class="bar-container">
  	<div class="bar-item">open</div>
  	<div class="bar-item">pending</div>
  	<div class="bar-item">unassigned</div>  
  	<div class="bar-item">overdue</div>
  	<div class="bar-item">soon overdue</div>
  	<div id="open" class="bar-item"></div>  
  	<div id="pending" class="bar-item"></div>
  	<div id="unassigned" class="bar-item"></div>
  	<div id="overdue" class="bar-item"></div> 
  	<div id="soonOverdue" class="bar-item"></div>
    </div>

    

    <div id="loadingStats">
	    </br></br>
	    <label><b>...loading your stats...</b></label></br></br>
	    <div class="loader"></div>
	    </br></br>
	    <div id="loaderMSG"></div>
	    </br>
    </div>

    <div id="loadedStats" style="display:none;">
	    <h2>Statistics:</h2>
	<label><b>Skill</b></label></br>   
	<div id="skill"></div>
	<label><b>Team</b></label></br>
 	<div id="team"></div>
	    </br>
	<label><b>Start custom date</b></label></br>
    	<input id="customDate" type="date" />
	<input id="customHour" type="time"></br>
	<label><b>End custom date</b></label></br>
    	<input id="endCustomDate" type="date" />
	<input id="endCustomHour" type="time"></br>
	<div id="refreshMSG"></div>
	<button type="button" id ="refresh" class="refresh" style="float: right;">Refresh</button>


</br></br>

	    
	<div class="grid-container-header">
  		<div class="grid-item"></div>
  		<div class="grid-item">last 30 days</div>
		<div class="grid-item">custom time</div>
  		<div class="grid-item">midnight-->now</div>  
  		<div class="grid-item">last 60 mins</div>
  		<div class="grid-item">last 10 mins</div>
  		<div class="grid-item-left">established</div>  
  		<div class="grid-item" id="lastMonthHeader"></div>
		<div class="grid-item" id="customTimeHeader"></div>
  		<div class="grid-item" id="lastDayHeader"></div>
  		<div class="grid-item" id="lastHourHeader"></div> 
  		<div class="grid-item" id="last10Header"></div>
	</div>
	<div class="grid-container-closed">
  		<div class="grid-item-left">closed</div>
  		<div class="grid-item" id="lastMonthClosedClosed"></div>
		<div class="grid-item" id="customTimeClosedClosed"></div>
  		<div class="grid-item" id="lastDayClosedClosed"></div>  
  		<div class="grid-item" id="lastHourClosedClosed"></div>
  		<div class="grid-item" id="last10ClosedClosed"></div>
		<div class="grid-item-left">manual closed</div>
  		<div class="grid-item" id="lastMonthClosedClosedManual"></div>
		<div class="grid-item" id="customTimeClosedClosedManual"></div>
  		<div class="grid-item" id="lastDayClosedClosedManual"></div>  
  		<div class="grid-item" id="lastHourClosedClosedManual"></div>
		<div class="grid-item" id="last10ClosedClosedManual"></div>
		<div class="grid-item-left">automatic closed</div>
  		<div class="grid-item" id="lastMonthClosedClosedAutomatic"></div>
		<div class="grid-item" id="customTimeClosedClosedAutomatic"></div>
  		<div class="grid-item" id="lastDayClosedClosedAutomatic"></div>  
  		<div class="grid-item" id="lastHourClosedClosedAutomatic"></div>
		<div class="grid-item" id="last10ClosedClosedAutomatic"></div>
		<div class="grid-item-left">time to accept</div>
  		<div class="grid-item" id="lastMonthClosedTimeToAccept"></div>
		<div class="grid-item" id="customTimeClosedTimeToAccept"></div>
  		<div class="grid-item" id="lastDayClosedTimeToAccept"></div>  
  		<div class="grid-item" id="lastHourClosedTimeToAccept"></div>
		<div class="grid-item" id="last10ClosedTimeToAccept"></div>
		<div class="grid-item-left">0-30 sec</div>
  		<div class="grid-item" id="lastMonthClosedTimeToAcceptFirstBulk"></div>
		<div class="grid-item" id="customTimeClosedTimeToAcceptFirstBulk"></div>
  		<div class="grid-item" id="lastDayClosedTimeToAcceptFirstBulk"></div>  
  		<div class="grid-item" id="lastHourClosedTimeToAcceptFirstBulk"></div>
		<div class="grid-item" id="last10ClosedTimeToAcceptFirstBulk"></div>
		<div class="grid-item-left">31-60 sec</div>
  		<div class="grid-item" id="lastMonthClosedTimeToAcceptSecondBulk"></div>
		<div class="grid-item" id="customTimeClosedTimeToAcceptSecondBulk"></div>
  		<div class="grid-item" id="lastDayClosedTimeToAcceptSecondBulk"></div>  
  		<div class="grid-item" id="lastHourClosedTimeToAcceptSecondBulk"></div>
		<div class="grid-item" id="last10ClosedTimeToAcceptSecondBulk"></div>
		<div class="grid-item-left">> 60 sec</div>
  		<div class="grid-item" id="lastMonthClosedTimeToAcceptThirdBulk"></div>
		<div class="grid-item" id="customTimeClosedTimeToAcceptThirdBulk"></div>
  		<div class="grid-item" id="lastDayClosedTimeToAcceptThirdBulk"></div>  
  		<div class="grid-item" id="lastHourClosedTimeToAcceptThirdBulk"></div>
		<div class="grid-item" id="last10ClosedTimeToAcceptThirdBulk"></div>
  		<div class="grid-item-left">first time answer</div>  
  		<div class="grid-item" id="lastMonthFTAClosed"></div>
		<div class="grid-item" id="customTimeFTAClosed"></div>
  		<div class="grid-item" id="lastDayFTAClosed"></div>
  		<div class="grid-item" id="lastHourFTAClosed"></div> 
  		<div class="grid-item" id="last10FTAClosed"></div>
		<div class="grid-item-left">0-30 sec</div>  
  		<div class="grid-item" id="lastMonthFTAClosedFirstBulk"></div>
		<div class="grid-item" id="customTimeFTAClosedFirstBulk"></div>
  		<div class="grid-item" id="lastDayFTAClosedFirstBulk"></div>
  		<div class="grid-item" id="lastHourFTAClosedFirstBulk"></div> 
  		<div class="grid-item" id="last10FTAClosedFirstBulk"></div>
		<div class="grid-item-left">31-60 sec</div>  
  		<div class="grid-item" id="lastMonthFTAClosedSecondBulk"></div>
		<div class="grid-item" id="customTimeFTAClosedSecondBulk"></div>
  		<div class="grid-item" id="lastDayFTAClosedSecondBulk"></div>
  		<div class="grid-item" id="lastHourFTAClosedSecondBulk"></div> 
  		<div class="grid-item" id="last10FTAClosedSecondBulk"></div>
		<div class="grid-item-left">> 60 sec</div>  
  		<div class="grid-item" id="lastMonthFTAClosedThirdBulk"></div>
		<div class="grid-item" id="customTimeFTAClosedThirdBulk"></div>
  		<div class="grid-item" id="lastDayFTAClosedThirdBulk"></div>
  		<div class="grid-item" id="lastHourFTAClosedThirdBulk"></div> 
  		<div class="grid-item" id="last10FTAClosedThirdBulk"></div>
  		<div class="grid-item-left">general time answer</div>  
  		<div class="grid-item" id="lastMonthGTAClosed"></div>
		<div class="grid-item" id="customTimeGTAClosed"></div>
  		<div class="grid-item" id="lastDayGTAClosed"></div>
  		<div class="grid-item" id="lastHourGTAClosed"></div> 
  		<div class="grid-item" id="last10GTAClosed"></div>
	</div>
	<div class="grid-container-open">
  		<div class="grid-item-left">open</div>
  		<div class="grid-item" id="lastMonthOpenOpen"></div>
		<div class="grid-item" id="customTimeOpenOpen"></div>
  		<div class="grid-item" id="lastDayOpenOpen"></div>  
  		<div class="grid-item" id="lastHourOpenOpen"></div>
  		<div class="grid-item" id="last10OpenOpen"></div>
		<div class="grid-item-left">time to accept</div>
  		<div class="grid-item" id="lastMonthOpenTimeToAccept"></div>
		<div class="grid-item" id="customTimeOpenTimeToAccept"></div>
  		<div class="grid-item" id="lastDayOpenTimeToAccept"></div>  
  		<div class="grid-item" id="lastHourOpenTimeToAccept"></div>
		<div class="grid-item" id="last10OpenTimeToAccept"></div>
		<div class="grid-item-left">0-30 sec</div>
  		<div class="grid-item" id="lastMonthOpenTimeToAcceptFirstBulk"></div>
		<div class="grid-item" id="customTimeOpenTimeToAcceptFirstBulk"></div>
  		<div class="grid-item" id="lastDayOpenTimeToAcceptFirstBulk"></div>  
  		<div class="grid-item" id="lastHourOpenTimeToAcceptFirstBulk"></div>
		<div class="grid-item" id="last10OpenTimeToAcceptFirstBulk"></div>
		<div class="grid-item-left">31-60 sec</div>
  		<div class="grid-item" id="lastMonthOpenTimeToAcceptSecondBulk"></div>
		<div class="grid-item" id="customTimeOpenTimeToAcceptSecondBulk"></div>
  		<div class="grid-item" id="lastDayOpenTimeToAcceptSecondBulk"></div>  
  		<div class="grid-item" id="lastHourOpenTimeToAcceptSecondBulk"></div>
		<div class="grid-item" id="last10OpenTimeToAcceptSecondBulk"></div>
		<div class="grid-item-left">> 60 sec</div>
  		<div class="grid-item" id="lastMonthOpenTimeToAcceptThirdBulk"></div>
		<div class="grid-item" id="customTimeOpenTimeToAcceptThirdBulk"></div>
  		<div class="grid-item" id="lastDayOpenTimeToAcceptThirdBulk"></div>  
  		<div class="grid-item" id="lastHourOpenTimeToAcceptThirdBulk"></div>
		<div class="grid-item" id="last10OpenTimeToAcceptThirdBulk"></div>
  		<div class="grid-item-left">first time answer</div>  
  		<div class="grid-item" id="lastMonthFTAOpen"></div>
		<div class="grid-item" id="customTimeFTAOpen"></div>
  		<div class="grid-item" id="lastDayFTAOpen"></div>
  		<div class="grid-item" id="lastHourFTAOpen"></div> 
  		<div class="grid-item" id="last10FTAOpen"></div>
		<div class="grid-item-left">0-30 sec</div>  
  		<div class="grid-item" id="lastMonthFTAOpenFirstBulk"></div>
		<div class="grid-item" id="customTimeFTAOpenFirstBulk"></div>
  		<div class="grid-item" id="lastDayFTAOpenFirstBulk"></div>
  		<div class="grid-item" id="lastHourFTAOpenFirstBulk"></div> 
  		<div class="grid-item" id="last10FTAOpenFirstBulk"></div>
		<div class="grid-item-left">31-60 sec</div>  
  		<div class="grid-item" id="lastMonthFTAOpenSecondBulk"></div>
		<div class="grid-item" id="customTimeFTAOpenSecondBulk"></div>
  		<div class="grid-item" id="lastDayFTAOpenSecondBulk"></div>
  		<div class="grid-item" id="lastHourFTAOpenSecondBulk"></div> 
  		<div class="grid-item" id="last10FTAOpenSecondBulk"></div>
		<div class="grid-item-left">> 60 sec</div>  
  		<div class="grid-item" id="lastMonthFTAOpenThirdBulk"></div>
		<div class="grid-item" id="customTimeFTAOpenThirdBulk"></div>
  		<div class="grid-item" id="lastDayFTAOpenThirdBulk"></div>
  		<div class="grid-item" id="lastHourFTAOpenThirdBulk"></div> 
  		<div class="grid-item" id="last10FTAOpenThirdBulk"></div>
  		<div class="grid-item-left">general time answer</div>  
  		<div class="grid-item" id="lastMonthGTAOpen"></div>
		<div class="grid-item" id="customTimeGTAOpen"></div>
  		<div class="grid-item" id="lastDayGTAOpen"></div>
  		<div class="grid-item" id="lastHourGTAOpen"></div> 
  		<div class="grid-item" id="last10GTAOpen"></div>
  		<div class="grid-item-left">pending</div>  
  		<div class="grid-item" id="lastMonthWaitingOpen"></div>
		<div class="grid-item" id="customTimeWaitingOpen"></div>
  		<div class="grid-item" id="lastDayWaitingOpen"></div>
  		<div class="grid-item" id="lastHourWaitingOpen"></div> 
  		<div class="grid-item" id="last10WaitingOpen"></div>
  		<div class="grid-item-left">unassigned</div>  
  		<div class="grid-item" id="lastMonthNAOpen"></div>
		<div class="grid-item" id="customTimeNAOpen"></div>
  		<div class="grid-item" id="lastDayNAOpen"></div>
  		<div class="grid-item" id="lastHourNAOpen"></div> 
  		<div class="grid-item" id="last10NAOpen"></div>
	</div>

	</br></br></br></br>

    </div>


  
    <h2>Download your transcripts:</h2>
    <label><b>Start date</b></label></br>

    <input id="startdate" type="date" />
    <input id="starthour" type="time">
    </br>

    <label><b>End date</b></label></br>

    <input id="enddate" type="date" />
    <input id="endhour" type="time">
    

    </br></br>
    <select name="DropDownTimezone" id="DropDownTimezone">
      <option>(GMT +1:00 hour) Rome, Brussels, Copenhagen, Madrid, Paris</option>
      <option>(GMT +2:00) Kaliningrad, South Africa</option>
      <option>(GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg</option>
      <option>(GMT +3:30) Tehran</option>
      <option>(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi</option>
      <option>(GMT +4:30) Kabul</option>
      <option>(GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent</option>
      <option>(GMT +5:30) Bombay, Calcutta, Madras, New Delhi</option>
      <option>(GMT +6:00) Almaty, Dhaka, Colombo</option>
      <option>(GMT +7:00) Bangkok, Hanoi, Jakarta</option>
      <option>(GMT +8:00) Beijing, Perth, Singapore, Hong Kong</option>
      <option>(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk</option>
      <option>(GMT +9:30) Adelaide, Darwin</option>
      <option>(GMT +10:00) Eastern Australia, Guam, Vladivostok</option>
      <option>(GMT +11:00) Magadan, Solomon Islands, New Caledonia</option>
      <option>(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka</option>
      <option>(GMT -12:00) Eniwetok, Kwajalein</option>
      <option>(GMT -11:00) Midway Island, Samoa</option>
      <option>(GMT -10:00) Hawaii</option>
      <option>(GMT -9:00) Alaska</option>
      <option>(GMT -8:00) Pacific Time (US &amp; Canada)</option>
      <option>(GMT -7:00) Mountain Time (US &amp; Canada)</option>
      <option>(GMT -6:00) Central Time (US &amp; Canada), Mexico City</option>
      <option>(GMT -5:00) Eastern Time (US &amp; Canada), Bogota, Lima</option>
      <option>(GMT -4:00) Atlantic Time (Canada), Caracas, La Paz</option>
      <option>(GMT -3:30) Newfoundland</option>
      <option>(GMT -3:00) Brazil, Buenos Aires, Georgetown</option>
      <option>(GMT -2:00) Mid-Atlantic</option>
      <option>(GMT -1:00 hour) Azores, Cape Verde Islands</option>
      <option>(GMT) Western Europe Time, London, Lisbon, Casablanca</option>
    </select>
    </br></br>


    <label><b>Options: </b></label>
    <select id="transcriptOptions">
        <option>Open</option>
        <option>Close</option>
        <option>Open+Close</option>
    </select>

    </br></br>

    <button type="button" id ="downloadTranscripts" class="downloadTranscripts">Download</button></br></br>
    <div id="reportMSG"></div>
    </br></br></br>

    <a id="hiddenbutton" style="visibility:hidden;" href="">Hidden</a>
</div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script>
  
  var uri = "";
  var facadeUri = "";
  var accountReadWrite = "";
  var timeZone = "";
  var skillNumber = -1;
  var teamNumber = 0;
  var skillArray = [];
  var teamArray = [];
  var uname;
  var pwd;
  var csrf;
  var accnumb = localStorage.getItem('account_number');
  var bearer = localStorage.getItem('bearer');
  var statisticOptions = 0;
  var customDate;
  var endCustomDate;
	
  function findBulk(Seconds){
	 if (Seconds <= 30){
		return 1; 
	 }
	  else if (Seconds <= 60){
		return 2;  
	  }
	  else{
		return 3;  
	  }
  }
  function percentage(a, b, c){
	  var a1 = parseInt(a);
	  var b1 = parseInt(b);
	  var c1 = parseInt(c);
	  var tot = a1 + b1 + c1;
	  if (tot){
		  var percent1 = Math.floor(100 * a1/tot);
		  var percent2 = Math.floor(100 * b1/tot);
		  var percent3 = 100 - percent1 - percent2;
		  var percent1 = percent1 + '%';
		  var percent2 = percent2 + '%';
		  var percent3 = percent3 + '%';
		  var response = [percent1, percent2, percent3];
		  return response;
	  }
	  else{
		  var percent1 = '--';
		  var percent2 = '--';
		  var percent3 = '--';
	  }
	  
	  
	  
	  
	  
	  
	  
	  
  }
  function secondsToString(timeInSeconds){
						      
	var hours;
	var minutes;
	var seconds;
	var diff;
	var stringAnswer;
	if (isNaN(timeInSeconds)){
		stringAnswer = "--";
		return stringAnswer;
	}
	if (Math.floor(timeInSeconds/(60*60)) > 0){
		hours = Math.floor(timeInSeconds/(60*60));
		diff = timeInSeconds - hours*60*60;
		if (Math.floor(diff/60) > 0){
			minutes = Math.floor(diff/60);
			seconds = Math.floor(diff - minutes*60);
			stringAnswer = hours + "h, " + minutes + "m, " + seconds + "s";
		}
		else{
			seconds = Math.floor(diff);
			stringAnswer = hours + "h, " + seconds + "s";
		}
	}
	else if (Math.floor(timeInSeconds/60) > 0){
		var minutes = Math.floor(timeInSeconds/60);
		var seconds = Math.floor(timeInSeconds - minutes*60);
		stringAnswer = minutes + "m, " + seconds + "s";
	}
	else{
		var seconds = Math.floor(timeInSeconds);
		stringAnswer = seconds + "s";
	}
	return stringAnswer;
  }
	
	
  function loadBar(){
	  
	  setTimeout(function(){
		  
	      	$.ajax({
                    url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/facadeMsg/baseURI.lpCsds?version=1.0",
                    jsonp: "cb",
                    jsonpCallback: "domainCallback",
                    cache: true,
                    dataType: "jsonp",
                    success: function success(data) {
                        if('lpCallError' in data.ResultSet){
				localStorage.setItem('account_number', '');
			   	location.reload(); 
                        }
                        else{
                           	facadeUri = data.ResultSet.lpData[0].lpServer;
                           	$.ajax({
                              		url: "https://" + facadeUri + "/api/messaging/rest/reporting/brands/" + accnumb + "/msgstatistics?v=1",
                              		method: "GET",
                              		jsonp: "cb",
                              		jsonpCallback: "domainCallback",
                              		cache: true,
                              		contentType: "application/json",
                              		success: function success(data) {
						document.getElementById("open").innerHTML = data.active;
						document.getElementById("pending").innerHTML = data.pending;
						document.getElementById("unassigned").innerHTML = data.unassigned;
						document.getElementById("overdue").innerHTML = data.overdue;
						document.getElementById("soonOverdue").innerHTML = data.soonToOverdue;
                              		},
                              		error: function error(e, text) {
						localStorage.setItem('account_number', '');
				    		location.reload(); 
                              		},
                              		beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); } 
                          	});   
                        }
                    },
                    error: function error(e, text) {
			    console.log(text);
			    localStorage.setItem('account_number', '');
			    location.reload(); 
                    }
              	});
	}, 1000);
  }
	
  function loadSkills(){
	  
	  setTimeout(function(){
		  
	      	$.ajax({
                    url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/accountConfigReadWrite/baseURI.lpCsds?version=1.0",
                    jsonp: "cb",
                    jsonpCallback: "domainCallback",
                    cache: true,
                    dataType: "jsonp",
                    success: function success(data) {
                        if('lpCallError' in data.ResultSet){
				localStorage.setItem('account_number', '');
			   	location.reload(); 
                        }
                        else{
                           	accountReadWrite = data.ResultSet.lpData[0].lpServer;
                           	$.ajax({
                              		url: "https://" + accountReadWrite + "/api/account/" + accnumb + "/configuration/le-users/skills",
                              		method: "GET",
                              		jsonp: "cb",
                              		jsonpCallback: "domainCallback",
                              		cache: true,
                              		contentType: "application/json",
                              		success: function success(data) {
						skillArray = data;
						var appendSkill = '<select name="skillSelector" id="skillName"><option>All</option>';
						var toAppend = '';
						var length = data.length;
						for (var m = 0; m < length; m++){
							toAppend = '<option>' + data[m].name + '</option>';
							appendSkill = appendSkill.concat(toAppend);
						}
						appendSkill = appendSkill.concat('</select>');
						$("#skill").append(appendSkill);
						$('#customDate').val($('#startdate').val());
						$('#endCustomDate').val($('#enddate').val());
						$('#customHour').val("00:00");
						$('#endCustomHour').val("23:59");
						var thisDate = $('#customDate').val();
						thisDate = new Date(thisDate);
						var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
						var year = thisDate.getFullYear();
						var month = months[thisDate.getMonth()];
						var date = thisDate.getDate();
						var hour = $('#customHour').val();
						thisDate = month + " " + date + " " + year + " " + hour + timeZone;
						var d = new Date(thisDate);
						customDate = d.getTime();
						thisDate = $('#endCustomDate').val();
						thisDate = new Date(thisDate);
						months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
						year = thisDate.getFullYear();
						month = months[thisDate.getMonth()];
						date = thisDate.getDate();
						hour = $('#endCustomHour').val();
						thisDate = month + " " + date + " " + year + " " + hour + timeZone;
						d = new Date(thisDate);
						endCustomDate = d.getTime();
						
						$('#customDate').on('change', function() {
							
							var thisDate = $('#customDate,#customHour').val();
							thisDate = new Date(thisDate);
							var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
							var year = thisDate.getFullYear();
							var month = months[thisDate.getMonth()];
							var date = thisDate.getDate();
							var hour = $('#customHour').val();
							thisDate = month + " " + date + " " + year + " " + hour + timeZone;
							var d = new Date(thisDate);
							customDate = d.getTime();
						})
						$('#endCustomDate,#endCustomHour').on('change', function() {
							
							var thisDate = $('#endCustomDate').val();
							thisDate = new Date(thisDate);
							var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
							var year = thisDate.getFullYear();
							var month = months[thisDate.getMonth()];
							var date = thisDate.getDate();
							var hour = $('#endCustomHour').val();
							thisDate = month + " " + date + " " + year + " " + hour + timeZone;
							var d = new Date(thisDate);
							endCustomDate = d.getTime();
							
						})
                              		},
                              		error: function error(e, text) {
						localStorage.setItem('account_number', '');
				    		location.reload(); 
                              		},
                              		beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); } 
                          	});   
                        }
                    },
                    error: function error(e, text) {
			    console.log(text);
			    localStorage.setItem('account_number', '');
			    location.reload(); 
                    }
              	});
	}, 2000);
  }
	
  function loadTeams(){
	  
	  setTimeout(function(){
		  
		  $.ajax({
			  url: "https://" + accountReadWrite + "/api/account/" + accnumb + "/configuration/le-users/agentGroups",
			  method: "GET",
			  jsonp: "cb",
			  jsonpCallback: "domainCallback",
			  cache: true,
			  contentType: "application/json",
			  "If-Match": "-1",
			  success: function success(data) {
				  teamArray = data;
				  var appendTeam = '<select name="teamSelector" id="teamName"><option>All</option>';
				  var toAppend = '';
				  var length = data.length;
				  for (var m = 0; m < length; m++){
					  toAppend = '<option>' + data[m].name + '</option>';
					  appendTeam = appendTeam.concat(toAppend);
				  }
				  appendTeam = appendTeam.concat('</select>');
				  $("#team").append(appendTeam);
			  },
			  error: function error(e, text) {
				  localStorage.setItem('account_number', '');
				  location.reload();
			  },
			  beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		  });
                       
	}, 3000);
  }
	
  function loadCustomStats(answer){
	  var length = answer.length;
	  var howManyMessages = 0;
	  var numberConvs = 0;
	  var whatTime = 0;
	  var isAnswered = 0;
	  var TimeAnswer = 0;
	  var totalTime = 0;
	  var numberTotal = 0;
	  console.log("(CUSTOM) skill: " + skillNumber + " ***** start: " + customDate + " ***** end: " + endCustomDate);
	  for (var m = 0; m < length; m++){
		  whatTime = answer[m].info.startTimeL;
		  if((whatTime > customDate) && (whatTime < endCustomDate)){
			 numberConvs = numberConvs + 1; 
		  }
	  }
	  document.getElementById("customTimeHeader").innerHTML = numberConvs;
	  numberConvs = 0;
	  for (var m = 0; m < length; m++){
		  if (answer[m].info.status === "OPEN"){
			  whatTime = answer[m].info.startTimeL;
			  if((whatTime > customDate) && (whatTime < endCustomDate)){
				 numberConvs = numberConvs + 1;  
			  }
		  }	 		  
	  }
	  document.getElementById("customTimeOpenOpen").innerHTML = numberConvs;
	  numberConvs = 0;
	  for (var m = 0; m < length; m++){
		  if (answer[m].info.status === "CLOSE"){
			  whatTime = answer[m].info.startTimeL;
			  if((whatTime > customDate) && (whatTime < endCustomDate)){
				 numberConvs = numberConvs + 1;  
			  }
		  }	 		  
	  }
	  document.getElementById("customTimeClosedClosed").innerHTML = numberConvs;
	  numberConvs = 0;
	  for (var m = 0; m < length; m++){
		  if (answer[m].info.status === "CLOSE" && answer[m].info.closeReasonDescription === "BRAND_AUTO_CLOSE"){
			  whatTime = answer[m].info.startTimeL;
			  if((whatTime > customDate) && (whatTime < endCustomDate)){
				 numberConvs = numberConvs + 1;  
			  }
		  }	 		  
	  }
	  document.getElementById("customTimeClosedClosedAutomatic").innerHTML = numberConvs;
	  numberConvs = 0;
	  for (var m = 0; m < length; m++){
		  if (answer[m].info.status === "CLOSE" && answer[m].info.closeReasonDescription === "MANUAL_CLOSE"){
			  whatTime = answer[m].info.startTimeL;
			  if((whatTime > customDate) && (whatTime < endCustomDate)){
				 numberConvs = numberConvs + 1;  
			  }
		  }	 		  
	  }
	  document.getElementById("customTimeClosedClosedManual").innerHTML = numberConvs;
	  numberConvs = 0;
	  for (var m = 0; m < length; m++){
		  if (answer[m].info.status === "OPEN" && answer[m].info.latestQueueState === "IN_QUEUE"){
			  whatTime = answer[m].info.startTimeL;
			  if((whatTime > customDate) && (whatTime < endCustomDate)){
				 numberConvs = numberConvs + 1;  
			  }
		  }	 		  
	  }
	  document.getElementById("customTimeNAOpen").innerHTML = numberConvs;
	  numberConvs = 0;
	  for (var m = 0; m < length; m++){
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
		 	if (answer[m].info.status === "OPEN" && answer[m].messageRecords[(howManyMessages - 1)].sentBy === "Consumer"){
				whatTime = answer[m].messageRecords[(howManyMessages - 1)].timeL;
				if ((whatTime > customDate) && (whatTime < endCustomDate)){
					numberConvs = numberConvs + 1;
		 		}
		 	}
		 }
	  }
	  document.getElementById("customTimeWaitingOpen").innerHTML = numberConvs;
	  numberConvs = 0;
	  totalTime = 0;
	  numberTotal = 0;
	  document.getElementById("customTimeClosedTimeToAcceptFirstBulk").innerHTML = 0;
	  document.getElementById("customTimeClosedTimeToAcceptSecondBulk").innerHTML = 0;
	  document.getElementById("customTimeClosedTimeToAcceptThirdBulk").innerHTML = 0;
	  for (var m = 0; m < length; m++){
		 TimeAnswer = 0;
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
		 	if (answer[m].info.status === "CLOSE" && answer[m].messageRecords[0].sentBy === "Consumer"){
				whatTime = answer[m].messageRecords[0].timeL;
				if(answer[m].hasOwnProperty('agentParticipants') && answer[m].agentParticipants.length){
					TimeAnswer = (answer[m].agentParticipants[0].timeL - whatTime)/1000;
					if ((whatTime > customDate) && (whatTime < endCustomDate)){
						totalTime = totalTime + TimeAnswer;
						numberTotal = numberTotal + 1;
						switch(findBulk(TimeAnswer)) {
							case 1:
								document.getElementById("customTimeClosedTimeToAcceptFirstBulk").innerHTML ++;
								break;
							case 2:
								document.getElementById("customTimeClosedTimeToAcceptSecondBulk").innerHTML ++;
								break;
							case 3:
								document.getElementById("customTimeClosedTimeToAcceptThirdBulk").innerHTML ++;
								break;
						}
		 			}
				}
		 	}
		 }
	  }
	  document.getElementById("customTimeClosedTimeToAccept").innerHTML = secondsToString(totalTime/numberTotal);
	  numberConvs = 0;
	  totalTime = 0;
	  numberTotal = 0;
	  document.getElementById("customTimeOpenTimeToAcceptFirstBulk").innerHTML = 0;
	  document.getElementById("customTimeOpenTimeToAcceptSecondBulk").innerHTML = 0;
	  document.getElementById("customTimeOpenTimeToAcceptThirdBulk").innerHTML = 0;
	  for (var m = 0; m < length; m++){
		 TimeAnswer = 0;
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
		 	if (answer[m].info.status === "OPEN" && answer[m].messageRecords[0].sentBy === "Consumer"){
				whatTime = answer[m].messageRecords[0].timeL;
				if(answer[m].hasOwnProperty('agentParticipants') && answer[m].agentParticipants.length){
					TimeAnswer = (answer[m].agentParticipants[0].timeL - whatTime)/1000;
					if ((whatTime > customDate) && (whatTime < endCustomDate)){
						totalTime = totalTime + TimeAnswer;
						numberTotal = numberTotal + 1;
						switch(findBulk(TimeAnswer)) {
							case 1:
								document.getElementById("customTimeOpenTimeToAcceptFirstBulk").innerHTML ++;
								break;
							case 2:
								document.getElementById("customTimeOpenTimeToAcceptSecondBulk").innerHTML ++;
								break;
							case 3:
								document.getElementById("customTimeOpenTimeToAcceptThirdBulk").innerHTML ++;
								break;
						}
		 			}
				}
		 	}
		 }
	  }
	  document.getElementById("customTimeOpenTimeToAccept").innerHTML = secondsToString(totalTime/numberTotal);
	  numberConvs = 0;
	  totalTime = 0;
	  numberTotal = 0;
	  isAnswered = 0;
	  document.getElementById("customTimeFTAOpenFirstBulk").innerHTML = 0;
	  document.getElementById("customTimeFTAOpenSecondBulk").innerHTML = 0;
	  document.getElementById("customTimeFTAOpenThirdBulk").innerHTML = 0;
	  for (var m = 0; m < length; m++){
		 TimeAnswer = 0;
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
			if (answer[m].info.status === "OPEN" && answer[m].messageRecords[0].sentBy === "Consumer"){
				whatTime = answer[m].messageRecords[0].timeL;
				isAnswered = 0;
				for (var n = 1; n < howManyMessages; n++){
					if(answer[m].messageRecords[n].sentBy === "Agent"){
						TimeAnswer = (answer[m].messageRecords[n].timeL - whatTime)/1000;
						isAnswered = 1;
						n = howManyMessages;
					}
				}
				if (isAnswered && ((whatTime > customDate) && (whatTime < endCustomDate))){
					totalTime = totalTime + TimeAnswer;
					numberTotal = numberTotal + 1;
					switch(findBulk(TimeAnswer)) {
							case 1:
								document.getElementById("customTimeFTAOpenFirstBulk").innerHTML ++;
								break;
							case 2:
								document.getElementById("customTimeFTAOpenSecondBulk").innerHTML ++;
								break;
							case 3:
								document.getElementById("customTimeFTAOpenThirdBulk").innerHTML ++;
								break;
						}
				}
		 	}	
		 }
		 
	  }
	  document.getElementById("customTimeFTAOpen").innerHTML = secondsToString(totalTime/numberTotal);
	  numberConvs = 0;
	  totalTime = 0;
	  numberTotal = 0;
	  isAnswered = 0;
	  document.getElementById("customTimeFTAClosedFirstBulk").innerHTML = 0;
	  document.getElementById("customTimeFTAClosedSecondBulk").innerHTML = 0;
	  document.getElementById("customTimeFTAClosedThirdBulk").innerHTML = 0;
	  for (var m = 0; m < length; m++){
		 TimeAnswer = 0;
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
			if (answer[m].info.status === "CLOSE" && answer[m].messageRecords[0].sentBy === "Consumer"){
				whatTime = answer[m].messageRecords[0].timeL;
				isAnswered = 0;
				for (var n = 1; n < howManyMessages; n++){
					if(answer[m].messageRecords[n].sentBy === "Agent"){
						TimeAnswer = (answer[m].messageRecords[n].timeL - whatTime)/1000;
						isAnswered = 1;
						n = howManyMessages;
					}
				}
				if (isAnswered && ((whatTime > customDate) && (whatTime < endCustomDate))){
					totalTime = totalTime + TimeAnswer;
					numberTotal = numberTotal + 1;
					switch(findBulk(TimeAnswer)) {
							case 1:
								document.getElementById("customTimeFTAClosedFirstBulk").innerHTML ++;
								break;
							case 2:
								document.getElementById("customTimeFTAClosedSecondBulk").innerHTML ++;
								break;
							case 3:
								document.getElementById("customTimeFTAClosedThirdBulk").innerHTML ++;
								break;
						}
				}
		 	}	
		 }
		 
	  }
	  document.getElementById("customTimeFTAClosed").innerHTML = secondsToString(totalTime/numberTotal);
	  numberConvs = 0;
	  totalTime = 0;
	  numberTotal = 0;
	  isAnswered = 0;
	  for (var m = 0; m < length; m++){
		 isAnswered = 0;
		 if(answer[m].info.status === "CLOSE"){
		 	TimeAnswer = 0;
		 	howManyMessages = answer[m].messageRecords.length;
			if(howManyMessages){
		 		for (var n = 0; n < howManyMessages; n++){
			 		if((answer[m].messageRecords[n].sentBy === "Consumer") && !isAnswered){
				 		whatTime = answer[m].messageRecords[n].timeL;
				 		isAnswered = 1;
			 		}
			 		else if((answer[m].messageRecords[n].sentBy === "Agent") && isAnswered){
				 		TimeAnswer = (answer[m].messageRecords[n].timeL - whatTime)/1000;
				 		if ((whatTime > customDate) && (whatTime < endCustomDate)){
							totalTime = totalTime + TimeAnswer;
							numberTotal = numberTotal + 1;
		 		 		}
				 		isAnswered = 0;
			 		}
		 		}
			}
		 }	 
	  }
	  document.getElementById("customTimeGTAClosed").innerHTML = secondsToString(totalTime/numberTotal);
	  numberConvs = 0;
	  totalTime = 0;
	  numberTotal = 0;
	  isAnswered = 0;
	  for (var m = 0; m < length; m++){
		 isAnswered = 0;
		 if(answer[m].info.status === "OPEN"){
		 	TimeAnswer = 0;
		 	howManyMessages = answer[m].messageRecords.length;
			if(howManyMessages){
		 		for (var n = 0; n < howManyMessages; n++){
			 		if((answer[m].messageRecords[n].sentBy === "Consumer") && !isAnswered){
				 		whatTime = answer[m].messageRecords[n].timeL;
				 		isAnswered = 1;
			 		}
			 		else if((answer[m].messageRecords[n].sentBy === "Agent") && isAnswered){
				 		TimeAnswer = (answer[m].messageRecords[n].timeL - whatTime)/1000;
				 		if ((whatTime > customDate) && (whatTime < endCustomDate)){
							totalTime = totalTime + TimeAnswer;
							numberTotal = numberTotal + 1;
		 		 		}
				 		isAnswered = 0;
			 		}
		 		}
			}
		 }	 
	  }
	  document.getElementById("customTimeGTAOpen").innerHTML = secondsToString(totalTime/numberTotal);
	 
   
		 
  }
	
  function loadStats(answer){
	  
	 var numberTenMinutesAgo = 0;
	 var numberOneHourAgo = 0;
	 var numberOneDayAgo = 0;
	 var numberOneMonthAgo = 0;
	 console.log(answer);
	 var length = answer.length;
	 var howManyMessages;
	 var TimeAnswer = 0;
	 var TotalTimeTenMinutesAgo = 0;
	 var TotalTimeOneHourAgo = 0;
	 var TotalTimeOneDayAgo = 0;
	 var TotalTimeOneMonthAgo = 0;
	 var isAnswered = 0;
	  
	 var date = new Date();
	 var dd = date.getDate();
	 if (dd < 10){
		 dd = "0" + dd;
	 }
    	 var mm = date.getMonth() + 1;
	 if (mm < 10){
		 mm = "0" + mm;
	 }
    	 var y = date.getFullYear();
	 var enddate = y + "-" + mm + "-" + dd;
	 
	 date.setDate(date.getDate());
	 var dd = date.getDate();
	 if (dd < 10){
		 dd = "0" + dd;
	 }
    	 var mm = date.getMonth() + 1;
	 if (mm < 10){
		 mm = "0" + mm;
	 }
    	 var y = date.getFullYear();
	 var startdate = y + "-" + mm + "-" + dd;
	  
	 startdate = new Date(startdate);
	 var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
	 var year = startdate.getFullYear();
  	 var month = months[startdate.getMonth()];
  	 var date = startdate.getDate(); 
	 var hour = $('#starthour').val();
	 startdate = month + " " + date + " " + year + " " + hour + timeZone;
	 var d = new Date(startdate);
	 var midnightToday = d.getTime();
	 var oneHourAgo = Date.now() - (1000*60*60);
	 var tenMinutesAgo = Date.now() - (1000*60*10);
	 var whatTime = 0;
	 for (var m = 0; m < length; m++){
		 whatTime = answer[m].info.startTimeL;
		 if (whatTime > tenMinutesAgo){
			numberTenMinutesAgo = numberTenMinutesAgo + 1; 
		 }
		 else if (whatTime > oneHourAgo){
			numberOneHourAgo = numberOneHourAgo + 1;
		 }
		 else if (whatTime > midnightToday){
			numberOneDayAgo = numberOneDayAgo + 1;
		 }
		 else{
			numberOneMonthAgo = numberOneMonthAgo + 1;
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 document.getElementById("last10Header").innerHTML = numberTenMinutesAgo;
	 document.getElementById("lastHourHeader").innerHTML = numberOneHourAgo;
	 document.getElementById("lastDayHeader").innerHTML = numberOneDayAgo;
	 document.getElementById("lastMonthHeader").innerHTML = numberOneMonthAgo;
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 for (var m = 0; m < length; m++){
		 whatTime = answer[m].info.startTimeL;
		 if (answer[m].info.status === "OPEN"){
			if (whatTime > tenMinutesAgo){
				numberTenMinutesAgo = numberTenMinutesAgo + 1; 
		 	}
		 	else if (whatTime > oneHourAgo){
				numberOneHourAgo = numberOneHourAgo + 1;
		 	}
		 	else if (whatTime > midnightToday){
				numberOneDayAgo = numberOneDayAgo + 1;
		 	}
		 	else{
				numberOneMonthAgo = numberOneMonthAgo + 1;
		 	} 
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 document.getElementById("last10OpenOpen").innerHTML = numberTenMinutesAgo;
	 document.getElementById("lastHourOpenOpen").innerHTML = numberOneHourAgo;
	 document.getElementById("lastDayOpenOpen").innerHTML = numberOneDayAgo;
	 document.getElementById("lastMonthOpenOpen").innerHTML = numberOneMonthAgo;
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 for (var m = 0; m < length; m++){
		 whatTime = answer[m].info.startTimeL;
		 if (answer[m].info.status === "CLOSE"){
			if (whatTime > tenMinutesAgo){
				numberTenMinutesAgo = numberTenMinutesAgo + 1; 
		 	}
		 	else if (whatTime > oneHourAgo){
				numberOneHourAgo = numberOneHourAgo + 1;
		 	}
		 	else if (whatTime > midnightToday){
				numberOneDayAgo = numberOneDayAgo + 1;
		 	}
		 	else{
				numberOneMonthAgo = numberOneMonthAgo + 1;
		 	} 
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 document.getElementById("last10ClosedClosed").innerHTML = numberTenMinutesAgo;
	 document.getElementById("lastHourClosedClosed").innerHTML = numberOneHourAgo;
	 document.getElementById("lastDayClosedClosed").innerHTML = numberOneDayAgo;
	 document.getElementById("lastMonthClosedClosed").innerHTML = numberOneMonthAgo;
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 for (var m = 0; m < length; m++){
		 whatTime = answer[m].info.startTimeL;
		 if (answer[m].info.status === "CLOSE" && answer[m].info.closeReasonDescription === "MANUAL_CLOSE"){
			if (whatTime > tenMinutesAgo){
				numberTenMinutesAgo = numberTenMinutesAgo + 1; 
		 	}
		 	else if (whatTime > oneHourAgo){
				numberOneHourAgo = numberOneHourAgo + 1;
		 	}
		 	else if (whatTime > midnightToday){
				numberOneDayAgo = numberOneDayAgo + 1;
		 	}
		 	else{
				numberOneMonthAgo = numberOneMonthAgo + 1;
		 	} 
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 document.getElementById("last10ClosedClosedManual").innerHTML = numberTenMinutesAgo;
	 document.getElementById("lastHourClosedClosedManual").innerHTML = numberOneHourAgo;
	 document.getElementById("lastDayClosedClosedManual").innerHTML = numberOneDayAgo;
	 document.getElementById("lastMonthClosedClosedManual").innerHTML = numberOneMonthAgo;
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 for (var m = 0; m < length; m++){
		 whatTime = answer[m].info.startTimeL;
		 if (answer[m].info.status === "CLOSE" && answer[m].info.closeReasonDescription === "BRAND_AUTO_CLOSE"){
			if (whatTime > tenMinutesAgo){
				numberTenMinutesAgo = numberTenMinutesAgo + 1; 
		 	}
		 	else if (whatTime > oneHourAgo){
				numberOneHourAgo = numberOneHourAgo + 1;
		 	}
		 	else if (whatTime > midnightToday){
				numberOneDayAgo = numberOneDayAgo + 1;
		 	}
		 	else{
				numberOneMonthAgo = numberOneMonthAgo + 1;
		 	} 
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 document.getElementById("last10ClosedClosedAutomatic").innerHTML = numberTenMinutesAgo;
	 document.getElementById("lastHourClosedClosedAutomatic").innerHTML = numberOneHourAgo;
	 document.getElementById("lastDayClosedClosedAutomatic").innerHTML = numberOneDayAgo;
	 document.getElementById("lastMonthClosedClosedAutomatic").innerHTML = numberOneMonthAgo;
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 for (var m = 0; m < length; m++){
		 whatTime = answer[m].info.startTimeL;
		 if (answer[m].info.status === "OPEN" && answer[m].info.latestQueueState === "IN_QUEUE"){
			if (whatTime > tenMinutesAgo){
				numberTenMinutesAgo = numberTenMinutesAgo + 1; 
		 	}
		 	else if (whatTime > oneHourAgo){
				numberOneHourAgo = numberOneHourAgo + 1;
		 	}
		 	else if (whatTime > midnightToday){
				numberOneDayAgo = numberOneDayAgo + 1;
		 	}
		 	else{
				numberOneMonthAgo = numberOneMonthAgo + 1;
		 	} 
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 document.getElementById("last10NAOpen").innerHTML = numberTenMinutesAgo;
	 document.getElementById("lastHourNAOpen").innerHTML = numberOneHourAgo;
	 document.getElementById("lastDayNAOpen").innerHTML = numberOneDayAgo;
	 document.getElementById("lastMonthNAOpen").innerHTML = numberOneMonthAgo;
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 for (var m = 0; m < length; m++){
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
		 if (answer[m].info.status === "OPEN" && answer[m].messageRecords[(howManyMessages - 1)].sentBy === "Consumer"){
			whatTime = answer[m].messageRecords[(howManyMessages - 1)].timeL;
			if (whatTime > tenMinutesAgo){
				numberTenMinutesAgo = numberTenMinutesAgo + 1; 
		 	}
		 	else if (whatTime > oneHourAgo){
				numberOneHourAgo = numberOneHourAgo + 1;
		 	}
		 	else if (whatTime > midnightToday){
				numberOneDayAgo = numberOneDayAgo + 1;
		 	}
		 	else{
				numberOneMonthAgo = numberOneMonthAgo + 1;
		 	} 
		 }
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 document.getElementById("last10WaitingOpen").innerHTML = numberTenMinutesAgo;
	 document.getElementById("lastHourWaitingOpen").innerHTML = numberOneHourAgo;
	 document.getElementById("lastDayWaitingOpen").innerHTML = numberOneDayAgo;
	 document.getElementById("lastMonthWaitingOpen").innerHTML = numberOneMonthAgo;
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 document.getElementById("last10FTAOpenFirstBulk").innerHTML = 0;
	 document.getElementById("last10FTAOpenSecondBulk").innerHTML = 0;
	 document.getElementById("last10FTAOpenThirdBulk").innerHTML = 0;
	 document.getElementById("lastHourFTAOpenFirstBulk").innerHTML = 0;
	 document.getElementById("lastHourFTAOpenSecondBulk").innerHTML = 0;
	 document.getElementById("lastHourFTAOpenThirdBulk").innerHTML = 0;
	 document.getElementById("lastDayFTAOpenFirstBulk").innerHTML = 0;
	 document.getElementById("lastDayFTAOpenSecondBulk").innerHTML = 0;
	 document.getElementById("lastDayFTAOpenThirdBulk").innerHTML = 0;
	 document.getElementById("lastMonthFTAOpenFirstBulk").innerHTML = 0;
	 document.getElementById("lastMonthFTAOpenSecondBulk").innerHTML = 0;
	 document.getElementById("lastMonthFTAOpenThirdBulk").innerHTML = 0;
	 for (var m = 0; m < length; m++){

		 TimeAnswer = 0;
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
		 if (answer[m].info.status === "OPEN" && answer[m].messageRecords[0].sentBy === "Consumer"){
			whatTime = answer[m].messageRecords[0].timeL;
			isAnswered = 0;
			for (var n = 1; n < howManyMessages; n++){
				if(answer[m].messageRecords[n].sentBy === "Agent"){
					TimeAnswer = (answer[m].messageRecords[n].timeL - whatTime)/1000;
					isAnswered = 1;
					n = howManyMessages;
				}
			}
			if (isAnswered && (whatTime > tenMinutesAgo)){
				TotalTimeTenMinutesAgo = TotalTimeTenMinutesAgo + TimeAnswer;
				numberTenMinutesAgo = numberTenMinutesAgo + 1;
				switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("last10FTAOpenFirstBulk").innerHTML ++;
						document.getElementById("lastHourFTAOpenFirstBulk").innerHTML ++;
						document.getElementById("lastDayFTAOpenFirstBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("last10FTAOpenSecondBulk").innerHTML ++;
						document.getElementById("lastHourFTAOpenSecondBulk").innerHTML ++;
						document.getElementById("lastDayFTAOpenSecondBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("last10FTAOpenThirdBulk").innerHTML ++;
						document.getElementById("lastHourFTAOpenThirdBulk").innerHTML ++;
						document.getElementById("lastDayFTAOpenThirdBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenThirdBulk").innerHTML ++;
						break;
				}
		 	}
		 	else if (isAnswered && (whatTime > oneHourAgo)){
				TotalTimeOneHourAgo = TotalTimeOneHourAgo + TimeAnswer;
				numberOneHourAgo = numberOneHourAgo + 1;
				switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastHourFTAOpenFirstBulk").innerHTML ++;
						document.getElementById("lastDayFTAOpenFirstBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastHourFTAOpenSecondBulk").innerHTML ++;
						document.getElementById("lastDayFTAOpenSecondBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastHourFTAOpenThirdBulk").innerHTML ++;
						document.getElementById("lastDayFTAOpenThirdBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenThirdBulk").innerHTML ++;
						break;
				}
		 	}
		 	else if (isAnswered && (whatTime > midnightToday)){
				TotalTimeOneDayAgo = TotalTimeOneDayAgo + TimeAnswer;
				numberOneDayAgo = numberOneDayAgo + 1;
				switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastDayFTAOpenFirstBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastDayFTAOpenSecondBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastDayFTAOpenThirdBulk").innerHTML ++;
						document.getElementById("lastMonthFTAOpenThirdBulk").innerHTML ++;
						break;
				}
		 	}
		 	else if (isAnswered){
				TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TimeAnswer;
				numberOneMonthAgo = numberOneMonthAgo + 1;
				switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastMonthFTAOpenFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastMonthFTAOpenSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastMonthFTAOpenThirdBulk").innerHTML ++;
						break;
				}
		 	} 
		 }
		 }
	 }
	 var perc = percentage(document.getElementById("lastMonthFTAOpenFirstBulk").innerHTML, document.getElementById("lastMonthFTAOpenSecondBulk").innerHTML, document.getElementById("lastMonthFTAOpenThirdBulk").innerHTML);
	 document.getElementById("lastMonthFTAOpenFirstBulk").innerHTML = perc[1];
	 document.getElementById("lastMonthFTAOpenSecondBulk").innerHTML = perc[2];
	 document.getElementById("lastMonthFTAOpenThirdBulk").innerHTML = perc[3];
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 TotalTimeOneHourAgo = TotalTimeTenMinutesAgo + TotalTimeOneHourAgo;
	 TotalTimeOneDayAgo = TotalTimeOneHourAgo + TotalTimeOneDayAgo;
	 TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TotalTimeOneDayAgo;
	 document.getElementById("last10FTAOpen").innerHTML = secondsToString(TotalTimeTenMinutesAgo/numberTenMinutesAgo);
	 document.getElementById("lastHourFTAOpen").innerHTML = secondsToString(TotalTimeOneHourAgo/numberOneHourAgo);
	 document.getElementById("lastDayFTAOpen").innerHTML = secondsToString(TotalTimeOneDayAgo/numberOneDayAgo);
	 document.getElementById("lastMonthFTAOpen").innerHTML = secondsToString(TotalTimeOneMonthAgo/numberOneMonthAgo);
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 TotalTimeTenMinutesAgo = 0;
	 TotalTimeOneHourAgo = 0;
	 TotalTimeOneDayAgo = 0;
	 TotalTimeOneMonthAgo = 0;
	 isAnswered = 0;
	 document.getElementById("last10FTAClosedFirstBulk").innerHTML = 0;
	 document.getElementById("last10FTAClosedSecondBulk").innerHTML = 0;
	 document.getElementById("last10FTAClosedThirdBulk").innerHTML = 0;
	 document.getElementById("lastHourFTAClosedFirstBulk").innerHTML = 0;
	 document.getElementById("lastHourFTAClosedSecondBulk").innerHTML = 0;
	 document.getElementById("lastHourFTAClosedThirdBulk").innerHTML = 0;
	 document.getElementById("lastDayFTAClosedFirstBulk").innerHTML = 0;
	 document.getElementById("lastDayFTAClosedSecondBulk").innerHTML = 0;
	 document.getElementById("lastDayFTAClosedThirdBulk").innerHTML = 0;
	 document.getElementById("lastMonthFTAClosedFirstBulk").innerHTML = 0;
	 document.getElementById("lastMonthFTAClosedSecondBulk").innerHTML = 0;
	 document.getElementById("lastMonthFTAClosedThirdBulk").innerHTML = 0;
	 for (var m = 0; m < length; m++){
		 TimeAnswer = 0;
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
		 if (answer[m].info.status === "CLOSE" && answer[m].messageRecords[0].sentBy === "Consumer"){
			whatTime = answer[m].messageRecords[0].timeL;
			isAnswered = 0;
			for (var n = 1; n < howManyMessages; n++){
				if(answer[m].messageRecords[n].sentBy === "Agent"){
					TimeAnswer = (answer[m].messageRecords[n].timeL - whatTime)/1000;
					isAnswered = 1;
					n = howManyMessages;
				}
			}
			if (isAnswered && (whatTime > tenMinutesAgo)){
				TotalTimeTenMinutesAgo = TotalTimeTenMinutesAgo + TimeAnswer;
				numberTenMinutesAgo = numberTenMinutesAgo + 1;
				switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("last10FTAClosedFirstBulk").innerHTML ++;
						document.getElementById("lastHourFTAClosedFirstBulk").innerHTML ++;
						document.getElementById("lastDayFTAClosedFirstBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("last10FTAClosedSecondBulk").innerHTML ++;
						document.getElementById("lastHourFTAClosedSecondBulk").innerHTML ++;
						document.getElementById("lastDayFTAClosedSecondBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("last10FTAClosedThirdBulk").innerHTML ++;
						document.getElementById("lastHourFTAClosedThirdBulk").innerHTML ++;
						document.getElementById("lastDayFTAClosedThirdBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedThirdBulk").innerHTML ++;
						break;
				}
		 	}
		 	else if (isAnswered && (whatTime > oneHourAgo)){
				TotalTimeOneHourAgo = TotalTimeOneHourAgo + TimeAnswer;
				numberOneHourAgo = numberOneHourAgo + 1;
				switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastHourFTAClosedFirstBulk").innerHTML ++;
						document.getElementById("lastDayFTAClosedFirstBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastHourFTAClosedSecondBulk").innerHTML ++;
						document.getElementById("lastDayFTAClosedSecondBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastHourFTAClosedThirdBulk").innerHTML ++;
						document.getElementById("lastDayFTAClosedThirdBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedThirdBulk").innerHTML ++;
						break;
				}
		 	}
		 	else if (isAnswered && (whatTime > midnightToday)){
				TotalTimeOneDayAgo = TotalTimeOneDayAgo + TimeAnswer;
				numberOneDayAgo = numberOneDayAgo + 1;
				switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastDayFTAClosedFirstBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastDayFTAClosedSecondBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastDayFTAClosedThirdBulk").innerHTML ++;
						document.getElementById("lastMonthFTAClosedThirdBulk").innerHTML ++;
						break;
				}
		 	}
		 	else if (isAnswered){
				TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TimeAnswer;
				numberOneMonthAgo = numberOneMonthAgo + 1;
				switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastMonthFTAClosedFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastMonthFTAClosedSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastMonthFTAClosedThirdBulk").innerHTML ++;
						break;
				}
		 	} 
		 }
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 TotalTimeOneHourAgo = TotalTimeTenMinutesAgo + TotalTimeOneHourAgo;
	 TotalTimeOneDayAgo = TotalTimeOneHourAgo + TotalTimeOneDayAgo;
	 TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TotalTimeOneDayAgo;
	 document.getElementById("last10FTAClosed").innerHTML = secondsToString(TotalTimeTenMinutesAgo/numberTenMinutesAgo);
	 document.getElementById("lastHourFTAClosed").innerHTML = secondsToString(TotalTimeOneHourAgo/numberOneHourAgo);
	 document.getElementById("lastDayFTAClosed").innerHTML = secondsToString(TotalTimeOneDayAgo/numberOneDayAgo);
	 document.getElementById("lastMonthFTAClosed").innerHTML = secondsToString(TotalTimeOneMonthAgo/numberOneMonthAgo);
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 TotalTimeTenMinutesAgo = 0;
	 TotalTimeOneHourAgo = 0;
	 TotalTimeOneDayAgo = 0;
	 TotalTimeOneMonthAgo = 0;
	 for (var m = 0; m < length; m++){
		 isAnswered = 0;
		 if(answer[m].info.status === "CLOSE"){
		 	TimeAnswer = 0;
		 	howManyMessages = answer[m].messageRecords.length;
			if(howManyMessages){
		 	for (var n = 0; n < howManyMessages; n++){
			 	if((answer[m].messageRecords[n].sentBy === "Consumer") && !isAnswered){
				 	whatTime = answer[m].messageRecords[n].timeL;
				 	isAnswered = 1;
			 	}
			 	else if((answer[m].messageRecords[n].sentBy === "Agent") && isAnswered){
				 	TimeAnswer = (answer[m].messageRecords[n].timeL - whatTime)/1000;
				 	if (whatTime > tenMinutesAgo){
						TotalTimeTenMinutesAgo = TotalTimeTenMinutesAgo + TimeAnswer;
						numberTenMinutesAgo = numberTenMinutesAgo + 1;
		 		 	}
		 		 	else if (whatTime > oneHourAgo){
						TotalTimeOneHourAgo = TotalTimeOneHourAgo + TimeAnswer;
						numberOneHourAgo = numberOneHourAgo + 1;
		 		 	}
		 		 	else if (whatTime > midnightToday){
						TotalTimeOneDayAgo = TotalTimeOneDayAgo + TimeAnswer;
						numberOneDayAgo = numberOneDayAgo + 1;
		 		 	}
		 		 	else{
						TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TimeAnswer;
						numberOneMonthAgo = numberOneMonthAgo + 1;
		 		 	} 
				 	isAnswered = 0;
			 	}
		 	}
			}
		 }	 
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 TotalTimeOneHourAgo = TotalTimeTenMinutesAgo + TotalTimeOneHourAgo;
	 TotalTimeOneDayAgo = TotalTimeOneHourAgo + TotalTimeOneDayAgo;
	 TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TotalTimeOneDayAgo;
	 document.getElementById("last10GTAClosed").innerHTML = secondsToString(TotalTimeTenMinutesAgo/numberTenMinutesAgo);
	 document.getElementById("lastHourGTAClosed").innerHTML = secondsToString(TotalTimeOneHourAgo/numberOneHourAgo);
	 document.getElementById("lastDayGTAClosed").innerHTML = secondsToString(TotalTimeOneDayAgo/numberOneDayAgo);
	 document.getElementById("lastMonthGTAClosed").innerHTML = secondsToString(TotalTimeOneMonthAgo/numberOneMonthAgo);
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 TotalTimeTenMinutesAgo = 0;
	 TotalTimeOneHourAgo = 0;
	 TotalTimeOneDayAgo = 0;
	 TotalTimeOneMonthAgo = 0;
	 for (var m = 0; m < length; m++){
		 isAnswered = 0;
		 if(answer[m].info.status === "OPEN"){
		 	TimeAnswer = 0;
		 	howManyMessages = answer[m].messageRecords.length;
			if(howManyMessages){
		 	for (var n = 0; n < howManyMessages; n++){
			 	if((answer[m].messageRecords[n].sentBy === "Consumer") && !isAnswered){
				 	whatTime = answer[m].messageRecords[n].timeL;
				 	isAnswered = 1;
			 	}
			 	else if((answer[m].messageRecords[n].sentBy === "Agent") && isAnswered){
				 	TimeAnswer = (answer[m].messageRecords[n].timeL - whatTime)/1000;
				 	if (whatTime > tenMinutesAgo){
						TotalTimeTenMinutesAgo = TotalTimeTenMinutesAgo + TimeAnswer;
						numberTenMinutesAgo = numberTenMinutesAgo + 1; 
		 		 	}
		 		 	else if (whatTime > oneHourAgo){
						TotalTimeOneHourAgo = TotalTimeOneHourAgo + TimeAnswer;
						numberOneHourAgo = numberOneHourAgo + 1;
		 		 	}
		 		 	else if (whatTime > midnightToday){
						TotalTimeOneDayAgo = TotalTimeOneDayAgo + TimeAnswer;
						numberOneDayAgo = numberOneDayAgo + 1;
		 		 	}
		 		 	else{
						TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TimeAnswer;
						numberOneMonthAgo = numberOneMonthAgo + 1;
		 		 	} 
				 	isAnswered = 0;
			 	}
		 	}
			}
		 }	 
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 TotalTimeOneHourAgo = TotalTimeTenMinutesAgo + TotalTimeOneHourAgo;
	 TotalTimeOneDayAgo = TotalTimeOneHourAgo + TotalTimeOneDayAgo;
	 TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TotalTimeOneDayAgo;
	 document.getElementById("last10GTAOpen").innerHTML = secondsToString(TotalTimeTenMinutesAgo/numberTenMinutesAgo);
	 document.getElementById("lastHourGTAOpen").innerHTML = secondsToString(TotalTimeOneHourAgo/numberOneHourAgo);
	 document.getElementById("lastDayGTAOpen").innerHTML = secondsToString(TotalTimeOneDayAgo/numberOneDayAgo);
	 document.getElementById("lastMonthGTAOpen").innerHTML = secondsToString(TotalTimeOneMonthAgo/numberOneMonthAgo);
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 TotalTimeTenMinutesAgo = 0;
	 TotalTimeOneHourAgo = 0;
	 TotalTimeOneDayAgo = 0;
	 TotalTimeOneMonthAgo = 0;
	 isAnswered = 0;
	 document.getElementById("last10ClosedTimeToAcceptFirstBulk").innerHTML = 0;
	 document.getElementById("last10ClosedTimeToAcceptSecondBulk").innerHTML = 0;
	 document.getElementById("last10ClosedTimeToAcceptThirdBulk").innerHTML = 0;
	 document.getElementById("lastHourClosedTimeToAcceptFirstBulk").innerHTML = 0;
	 document.getElementById("lastHourClosedTimeToAcceptSecondBulk").innerHTML = 0;
	 document.getElementById("lastHourClosedTimeToAcceptThirdBulk").innerHTML = 0;
	 document.getElementById("lastDayClosedTimeToAcceptFirstBulk").innerHTML = 0;
	 document.getElementById("lastDayClosedTimeToAcceptSecondBulk").innerHTML = 0;
	 document.getElementById("lastDayClosedTimeToAcceptThirdBulk").innerHTML = 0;
	 document.getElementById("lastMonthClosedTimeToAcceptFirstBulk").innerHTML = 0;
	 document.getElementById("lastMonthClosedTimeToAcceptSecondBulk").innerHTML = 0;
	 document.getElementById("lastMonthClosedTimeToAcceptThirdBulk").innerHTML = 0;
	 for (var m = 0; m < length; m++){
		 TimeAnswer = 0;
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
		 if (answer[m].info.status === "CLOSE" && answer[m].messageRecords[0].sentBy === "Consumer"){
			whatTime = answer[m].messageRecords[0].timeL;
			if(answer[m].hasOwnProperty('agentParticipants') && answer[m].agentParticipants.length){
				TimeAnswer = (answer[m].agentParticipants[0].timeL - whatTime)/1000;
				if (whatTime > tenMinutesAgo){
					TotalTimeTenMinutesAgo = TotalTimeTenMinutesAgo + TimeAnswer;
					numberTenMinutesAgo = numberTenMinutesAgo + 1;
					switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("last10ClosedTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastHourClosedTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastDayClosedTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("last10ClosedTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastHourClosedTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastDayClosedTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("last10ClosedTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastHourClosedTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastDayClosedTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptThirdBulk").innerHTML ++;
						break;
					}
		 		}
		 		else if (whatTime > oneHourAgo){
					TotalTimeOneHourAgo = TotalTimeOneHourAgo + TimeAnswer;
					numberOneHourAgo = numberOneHourAgo + 1;
					switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastHourClosedTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastDayClosedTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastHourClosedTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastDayClosedTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastHourClosedTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastDayClosedTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptThirdBulk").innerHTML ++;
						break;
					}
		 		}
		 		else if (whatTime > midnightToday){
					TotalTimeOneDayAgo = TotalTimeOneDayAgo + TimeAnswer;
					numberOneDayAgo = numberOneDayAgo + 1;
					switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastDayClosedTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastDayClosedTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastDayClosedTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastMonthClosedTimeToAcceptThirdBulk").innerHTML ++;
						break;
					}
		 		}
		 		else {
					TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TimeAnswer;
					numberOneMonthAgo = numberOneMonthAgo + 1;
					switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastMonthClosedTimeToAcceptFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastMonthClosedTimeToAcceptSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastMonthClosedTimeToAcceptThirdBulk").innerHTML ++;
						break;
					}
		 		}
			}
		 }
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 TotalTimeOneHourAgo = TotalTimeTenMinutesAgo + TotalTimeOneHourAgo;
	 TotalTimeOneDayAgo = TotalTimeOneHourAgo + TotalTimeOneDayAgo;
	 TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TotalTimeOneDayAgo;
	 document.getElementById("last10ClosedTimeToAccept").innerHTML = secondsToString(TotalTimeTenMinutesAgo/numberTenMinutesAgo);
	 document.getElementById("lastHourClosedTimeToAccept").innerHTML = secondsToString(TotalTimeOneHourAgo/numberOneHourAgo);
	 document.getElementById("lastDayClosedTimeToAccept").innerHTML = secondsToString(TotalTimeOneDayAgo/numberOneDayAgo);
	 document.getElementById("lastMonthClosedTimeToAccept").innerHTML = secondsToString(TotalTimeOneMonthAgo/numberOneMonthAgo);
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 TotalTimeTenMinutesAgo = 0;
	 TotalTimeOneHourAgo = 0;
	 TotalTimeOneDayAgo = 0;
	 TotalTimeOneMonthAgo = 0;
	 isAnswered = 0;
	 document.getElementById("last10OpenTimeToAcceptFirstBulk").innerHTML = 0;
	 document.getElementById("last10OpenTimeToAcceptSecondBulk").innerHTML = 0;
	 document.getElementById("last10OpenTimeToAcceptThirdBulk").innerHTML = 0;
	 document.getElementById("lastHourOpenTimeToAcceptFirstBulk").innerHTML = 0;
	 document.getElementById("lastHourOpenTimeToAcceptSecondBulk").innerHTML = 0;
	 document.getElementById("lastHourOpenTimeToAcceptThirdBulk").innerHTML = 0;
	 document.getElementById("lastDayOpenTimeToAcceptFirstBulk").innerHTML = 0;
	 document.getElementById("lastDayOpenTimeToAcceptSecondBulk").innerHTML = 0;
	 document.getElementById("lastDayOpenTimeToAcceptThirdBulk").innerHTML = 0;
	 document.getElementById("lastMonthOpenTimeToAcceptFirstBulk").innerHTML = 0;
	 document.getElementById("lastMonthOpenTimeToAcceptSecondBulk").innerHTML = 0;
	 document.getElementById("lastMonthOpenTimeToAcceptThirdBulk").innerHTML = 0;
	 for (var m = 0; m < length; m++){
		 TimeAnswer = 0;
		 howManyMessages = answer[m].messageRecords.length;
		 if(howManyMessages){
		 if (answer[m].info.status === "OPEN" && answer[m].messageRecords[0].sentBy === "Consumer"){
			whatTime = answer[m].messageRecords[0].timeL;
			if(answer[m].hasOwnProperty('agentParticipants') && answer[m].agentParticipants.length){
				TimeAnswer = (answer[m].agentParticipants[0].timeL - whatTime)/1000;
				if (whatTime > tenMinutesAgo){
					TotalTimeTenMinutesAgo = TotalTimeTenMinutesAgo + TimeAnswer;
					numberTenMinutesAgo = numberTenMinutesAgo + 1;
					switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("last10OpenTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastHourOpenTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastDayOpenTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("last10OpenTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastHourOpenTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastDayOpenTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("last10OpenTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastHourOpenTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastDayOpenTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptThirdBulk").innerHTML ++;
						break;
					}
		 		}
		 		else if (whatTime > oneHourAgo){
					TotalTimeOneHourAgo = TotalTimeOneHourAgo + TimeAnswer;
					numberOneHourAgo = numberOneHourAgo + 1;
					switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastHourOpenTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastDayOpenTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastHourOpenTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastDayOpenTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastHourOpenTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastDayOpenTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptThirdBulk").innerHTML ++;
						break;
					}
		 		}
		 		else if (whatTime > midnightToday){
					TotalTimeOneDayAgo = TotalTimeOneDayAgo + TimeAnswer;
					numberOneDayAgo = numberOneDayAgo + 1;
					switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastDayOpenTimeToAcceptFirstBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastDayOpenTimeToAcceptSecondBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastDayOpenTimeToAcceptThirdBulk").innerHTML ++;
						document.getElementById("lastMonthOpenTimeToAcceptThirdBulk").innerHTML ++;
						break;
					}
		 		}
		 		else {
					TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TimeAnswer;
					numberOneMonthAgo = numberOneMonthAgo + 1;
					switch(findBulk(TimeAnswer)) {
					case 1:
						document.getElementById("lastMonthOpenTimeToAcceptFirstBulk").innerHTML ++;
						break;
					case 2:
						document.getElementById("lastMonthOpenTimeToAcceptSecondBulk").innerHTML ++;
						break;
					case 3:
						document.getElementById("lastMonthOpenTimeToAcceptThirdBulk").innerHTML ++;
						break;
					}
		 		}
			}
		 }
		 }
	 }
	 numberOneHourAgo = numberTenMinutesAgo + numberOneHourAgo;
	 numberOneDayAgo = numberOneDayAgo + numberOneHourAgo;
	 numberOneMonthAgo = numberOneMonthAgo + numberOneDayAgo;
	 TotalTimeOneHourAgo = TotalTimeTenMinutesAgo + TotalTimeOneHourAgo;
	 TotalTimeOneDayAgo = TotalTimeOneHourAgo + TotalTimeOneDayAgo;
	 TotalTimeOneMonthAgo = TotalTimeOneMonthAgo + TotalTimeOneDayAgo;
	 document.getElementById("last10OpenTimeToAccept").innerHTML = secondsToString(TotalTimeTenMinutesAgo/numberTenMinutesAgo);
	 document.getElementById("lastHourOpenTimeToAccept").innerHTML = secondsToString(TotalTimeOneHourAgo/numberOneHourAgo);
	 document.getElementById("lastDayOpenTimeToAccept").innerHTML = secondsToString(TotalTimeOneDayAgo/numberOneDayAgo);
	 document.getElementById("lastMonthOpenTimeToAccept").innerHTML = secondsToString(TotalTimeOneMonthAgo/numberOneMonthAgo);
	 numberTenMinutesAgo = 0;
	 numberOneHourAgo = 0;
	 numberOneDayAgo = 0;
	 numberOneMonthAgo = 0;
	 TotalTimeTenMinutesAgo = 0;
	 TotalTimeOneHourAgo = 0;
	 TotalTimeOneDayAgo = 0;
	 TotalTimeOneMonthAgo = 0;
	 isAnswered = 0;
	  
	 $('#loadingStats').css('display', 'none');
	 $('#loadedStats').css('display', 'inline');
  
	 
  }
	
  	
  
  function checklogin(accnumb, bearer){	
	$('#myloader').css('display', 'inline');
  	if(!((accnumb === null) || (accnumb === '') || (bearer === null) || (bearer === ''))){
    		$.ajax({
                    url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/msgHist/baseURI.lpCsds?version=1.0",
                    jsonp: "cb",
                    jsonpCallback: "domainCallback",
                    cache: true,
                    dataType: "jsonp",
                    success: function success(data) {
                        if('lpCallError' in data.ResultSet){
				localStorage.setItem('account_number', '');
			   	location.reload(); 
                        }
                        else{
                           	uri = data.ResultSet.lpData[0].lpServer;
				console.log(data);
                           	console.log(uri);
                           	$.ajax({
                              		url: "https://" + uri + "/messaging_history/api/account/" + accnumb + "/conversations/search?offset=0&limit=50",
                              		method: "POST",
                              		jsonp: "cb",
                              		jsonpCallback: "domainCallback",
                              		cache: true,
                              		contentType: "application/json",
                              		data: '{\"start":{\"from\":' + (new Date().getTime()-5000) + ',\"to\":'+ new Date().getTime() + '}}',
                              		success: function success(data) {
						$('#myloader').css('display', 'none');
          					$('#myreports').css('display', 'inline');
						loadBar();
						loadSkills();
						loadTeams();
						refreshTranscripts();
						loadConvs();
                              		},
                              		error: function error(e, text) {
						localStorage.setItem('account_number', '');
				    		location.reload(); 
                              		},
                              		beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); } 
                          	});   
                        }
                    },
                    error: function error(e, text) {
			    console.log(text);
			    localStorage.setItem('account_number', '');
			    location.reload(); 
                    }
              	});
  	  }
	  else{
		  $('#myloader').css('display', 'none');
		  $('#mylogin').css('display', 'inline');
	  }
  }
	
	
checklogin(accnumb, bearer);
  
	
	
  $(document).on('click', function(evt) {
	  if($(evt.target).is('#logout')) {
		  $('#myreports').css('display', 'none');
		  $('#myloader').css('display', 'inline');
		  setTimeout(function(){
			  localStorage.setItem('account_number', '');
			  location.reload();
		  }, 2000);
	  }
	  if($(evt.target).is('#refresh')) {
		  
		  var isChanged = 0;
		  var length = skillArray.length;
		  for (var m = 0; m < length; m++){
			  if(skillArray[m].name === $("#skillName").val()){
				  skillNumber = skillArray[m].id;
				  isChanged = 1;
			  }
		  }
		  if (!isChanged){
			  skillNumber = -1;
		  }
		  length = teamArray.length;
		  for (var m = 0; m < length; m++){
			  if(teamArray[m].name === $("#teamName").val()){
				  teamNumber = teamArray[m].id;
				  console.log("teamNumber="+teamNumber);
			  }
		  }
		  if((endCustomDate > Date.now())){
			  document.getElementById("refreshMSG").innerHTML = "Please do not insert a future date!";
			  document.getElementById("refreshMSG").style = "color : red";					  
		  }
		  else if (customDate < (Date.now() - (1000*60*60*24*30))){
			  document.getElementById("refreshMSG").innerHTML = "Please do a query related to the last 30 days!";
			  document.getElementById("refreshMSG").style = "color : red";
		  }
		  else if (customDate > endCustomDate){
			  document.getElementById("refreshMSG").innerHTML = "Start date ist more recent than the end date!";
			  document.getElementById("refreshMSG").style = "color : red";
		  }
		  else{
			  document.getElementById("refreshMSG").innerHTML = "";
			  console.log("skill:" + skillNumber + "*****start:" + customDate + "*****end:" + endCustomDate);
			  loadConvs();
		  }
		  
		  							
	  }
  });
		  	
  
  $(document).on('click', function(evt) {
	  if($("#accnumb").val() != ""){
		  if($(evt.target).is('#submitLogin')) {
			  uname = $("#uname").val();
			  pwd = $("#pwd").val();
			  accnumb = $("#accnumb").val();
			  console.log(accnumb + " *** " + uname + " *** " + pwd);
			  $.ajax({
				  url: "https://adminlogin.liveperson.net/csdr/account/" + accnumb + "/service/agentVep/baseURI.lpCsds?version=1.0",
				  jsonp: "cb",
				  jsonpCallback: "domainCallback",
				  cache: true,
				  dataType: "jsonp",
				  success: function success(data) {
					  if('lpCallError' in data.ResultSet){
						  document.getElementById("sendStat").innerHTML = "Please insert a correct login!";
						  document.getElementById("sendStat").style = "color : red";
					  }
					  else{
						  uri = data.ResultSet.lpData[0].lpServer;
						  console.log(uri);
						  $.ajax({
							  url: "https://" + uri + "/api/account/" + accnumb + "/login?v=1.3",
							  method: "POST",
							  jsonp: "cb",
							  jsonpCallback: "domainCallback",
							  cache: true,
							  contentType: "application/json",
							  data: '{"username":"' + uname + '","password":"' + pwd +'"}',
							  success: function success(data) {
								  csrf = data.csrf;
								  bearer = data.bearer;
								  localStorage.setItem('account_number', accnumb);
								  localStorage.setItem('csrf', csrf);
								  localStorage.setItem('bearer', bearer);
								  $('#mylogin').css('display', 'none');
								  $('#myloader').css('display', 'inline');
								  setTimeout(function(){
									  $('#myloader').css('display', 'none');
									  $('#myreports').css('display', 'inline');
									  loadBar();
									  loadSkills();
									  loadTeams();
									  refreshTranscripts();
									  loadConvs();
								  }, 2000);
							  },
							  error: function error(e, text) {
								  document.getElementById("sendStat").innerHTML = "Please insert a correct login!";
								  document.getElementById("sendStat").style = "color : red";
							  }
						  });
						  return data;
					  }
				  },
				  error: function error(e, text) {
					  console.log(text);
					  return e;
				  }
			  });
		  }
	  }
  });
    
  function refreshTranscripts(){
	  
	 var date = new Date();
	 var dd = date.getDate();
	 if (dd < 10){
		 dd = "0" + dd;
	 }
    	 var mm = date.getMonth() + 1;
	 if (mm < 10){
		 mm = "0" + mm;
	 }
    	 var y = date.getFullYear();
	 var enddate = y + "-" + mm + "-" + dd;
	 
	 date.setDate(date.getDate() - 7);
	 var dd = date.getDate();
	 if (dd < 10){
		 dd = "0" + dd;
	 }
    	 var mm = date.getMonth() + 1;
	 if (mm < 10){
		 mm = "0" + mm;
	 }
    	 var y = date.getFullYear();
	 var startdate = y + "-" + mm + "-" + dd;
	 
	 $('#startdate').val(startdate);
	 $('#starthour').val("00:00");
	 $('#enddate').val(enddate);
	 $('#endhour').val("23:59");
	 
	 
  		
	  
	 $(document).on('click', function(evt) {
		 
              if($(evt.target).is('.downloadTranscripts')) {
		
		      console.log($("#DropDownTimezone").val());
		      switch($("#DropDownTimezone").val()) {
    				case "(GMT +1:00 hour) Rome, Brussels, Copenhagen, Madrid, Paris":
        				timeZone = ":00 GMT+0100";
        			break;
    				case "(GMT +2:00) Kaliningrad, South Africa":
        				timeZone = ":00 GMT+0200";
        			break;
    				case "(GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg":
        				timeZone = ":00 GMT+0300";
        			break;
				case "(GMT +3:30) Tehran":
        				timeZone = ":00 GMT+0330";
        			break;
    				case "(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi":
        				timeZone = ":00 GMT+0400";
        			break;
    				case "(GMT +4:30) Kabul":
        				timeZone = ":00 GMT+0430";
        			break;
    				case "(GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent":
        				timeZone = ":00 GMT+0500";
        			break;
				case "(GMT +5:30) Bombay, Calcutta, Madras, New Delhi":
        				timeZone = ":00 GMT+0530";
        			break;
    				case "(GMT +6:00) Almaty, Dhaka, Colombo":
        				timeZone = ":00 GMT+0600";
        			break;
    				case "(GMT +7:00) Bangkok, Hanoi, Jakarta":
        				timeZone = ":00 GMT+0700";
        			break;
				case "(GMT +8:00) Beijing, Perth, Singapore, Hong Kong":
        				timeZone = ":00 GMT+0800";
        			break;
				case "(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk":
        				timeZone = ":00 GMT+0900";
        			break;
				case "(GMT +9:30) Adelaide, Darwin":
        				timeZone = ":00 GMT+0930";
        			break;
    				case "(GMT +10:00) Eastern Australia, Guam, Vladivostok":
        				timeZone = ":00 GMT+1000";
        			break;
    				case "(GMT +11:00) Magadan, Solomon Islands, New Caledonia":
        				timeZone = ":00 GMT+1100";
        			break;
    				case "(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka":
        				timeZone = ":00 GMT+1200";
        			break;
				case "(GMT -12:00) Eniwetok, Kwajalein":
        				timeZone = ":00 GMT-1200";
        			break;
    				case "(GMT -11:00) Midway Island, Samoa":
        				timeZone = ":00 GMT-1100";
        			break;
				case "(GMT -10:00) Hawaii":
        				timeZone = ":00 GMT-1000";
        			break;
    				case "(GMT -9:00) Alaska":
        				timeZone = ":00 GMT-0900";
        			break;
    				case "(GMT -8:00) Pacific Time (US &amp; Canada)":
        				timeZone = ":00 GMT-0800";
        			break;
    				case "(GMT -7:00) Mountain Time (US &amp; Canada)":
        				timeZone = ":00 GMT-0700";
        			break;
				case "(GMT -6:00) Central Time (US &amp; Canada), Mexico City":
        				timeZone = ":00 GMT-0600";
        			break;
				case "(GMT -5:00) Eastern Time (US &amp; Canada), Bogota, Lima":
        				timeZone = ":00 GMT-0500";
        			break;
				case "(GMT -4:00) Atlantic Time (Canada), Caracas, La Paz":
        				timeZone = ":00 GMT-0400";
        			break;
    				case "(GMT -3:30) Newfoundland":
        				timeZone = ":00 GMT-0330";
        			break;
    				case "(GMT -3:00) Brazil, Buenos Aires, Georgetown":
        				timeZone = ":00 GMT-0300";
        			break;
    				case "(GMT -2:00) Mid-Atlantic":
        				timeZone = ":00 GMT-0200";
        			break;
				case "(GMT -1:00 hour) Azores, Cape Verde Islands":
        				timeZone = ":00 GMT-0100";
        			break;
				case "(GMT) Western Europe Time, London, Lisbon, Casablanca":
        				timeZone = ":00 GMT+0000";
        			break;
			}
		      
		      
		      
		     
		    startdate = $('#startdate').val();
		    startdate = new Date(startdate);
		    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
		    var year = startdate.getFullYear();
  		    var month = months[startdate.getMonth()];
  	            var date = startdate.getDate(); 
		    var hour = $('#starthour').val();
		    startdate = month + " " + date + " " + year + " " + hour + timeZone;
		    var d = new Date(startdate);
		    var start = d.getTime();
		      
		    
		    enddate = $('#enddate').val();
		    enddate = new Date(enddate);
		    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
		    var year = enddate.getFullYear();
  		    var month = months[enddate.getMonth()];
  	            var date = enddate.getDate(); 
		    var hour = $('#endhour').val();
		    enddate = month + " " + date + " " + year + " " + hour + timeZone;
		    var d = new Date(enddate);
		    var end = d.getTime();  
		    var options = $('#transcriptOptions').val();
		      
		    if (start >= end) { 
			    document.getElementById("reportMSG").innerHTML = "Please insert a correct end date!";
                            document.getElementById("reportMSG").style = "color : red"; 
		    }
		    else if (((end - start)/1000) > (60*60*24*30)){
			    document.getElementById("reportMSG").innerHTML = "No more than 30 days!";
                            document.getElementById("reportMSG").style = "color : red"; 
		    }
		    else{
			    document.getElementById("reportMSG").innerHTML = "";
			    downloadTranscripts(start, end, options);
		    }
		      
		      
		    
              }
	 });
	  
	  
  }
    
 
 function loadConvs(){
	 
	 
	 $('#loadedStats').css('display', 'none');
	 $('#loadingStats').css('display', 'inline');
	 
	 var end = Date.now();
	 var start = end - (1000*60*60*24*30);  // loading Convs started till 30 days ago
	 var offset = 0;
	 var body = "";
	 var answer = [];
	 if(skillNumber === -1){
		 body = '{"start":{"from":' + start + ',"to":' + end + '}, "status": ["OPEN"]';
	 }
	 else{
		 body = '{"start":{"from":' + start + ',"to":' + end + '}, "status": ["OPEN"], "skillIds": ["' + skillNumber + '"]';
	 }
	 if (teamNumber){
		 body = body + ' ,"agentGroupIds":["' + teamNumber + '"]}';
	 }
	 else{
		 body = body + '}';
	 }
	 
	 console.log(body);
	 console.log("(HISTORICAL) skill: " + skillNumber + " ***** team: " + teamNumber + " ***** start: " + start + " ***** end: " + end);
	 function loadClosedConvs(body, offset, callback) {
	 
	 	$.ajax({
                              url: "https://" + uri + "/messaging_history/api/account/" + accnumb + "/conversations/search?offset=" + offset + "&limit=100&sort=start:desc",
                              method: "POST",
                              jsonp: "cb",
                              jsonpCallback: "domainCallback",
                              cache: true,
                              contentType: "application/json",
                              data: body,
                              success: function success(data) {
				      if((data.conversationHistoryRecords.length) == 100){
					      offset = offset + 100;
					      answer = answer.concat(data.conversationHistoryRecords);
					      document.getElementById("loaderMSG").innerHTML = "...downloading sessions:" + Math.round(100*(offset/data._metadata.count)) + "% completed...";
					      document.getElementById("loaderMSG").style = "color : green";
					      console.log ("adding conversations...");
					      loadClosedConvs(body, offset, callback);
				      }
				      else{
					      console.log(answer.length);
					      answer = answer.concat(data.conversationHistoryRecords);
					      console.log(answer.length);
					      loadCustomStats(answer);
					      loadStats(answer);
				      }
				      
     
				      
                              },
                              error: function error(e, text) {
				      location.reload();
                              },
                              beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		});
	 }
	 
	 function loadOpenConvs(body, offset, callback) {
		 
	 
	 	$.ajax({
                              url: "https://" + uri + "/messaging_history/api/account/" + accnumb + "/conversations/search?offset=" + offset + "&limit=100",
                              method: "POST",
                              jsonp: "cb",
                              jsonpCallback: "domainCallback",
                              cache: true,
                              contentType: "application/json",
                              data: body,
                              success: function success(data) {
				      if((data.conversationHistoryRecords.length) == 100){
					      offset = offset + 100;
					      answer = answer.concat(data.conversationHistoryRecords);
					      document.getElementById("loaderMSG").innerHTML = "...downloading open sessions:" + Math.round(100*(offset/data._metadata.count)) + "% completed...";
					      document.getElementById("loaderMSG").style = "color : green";
					      console.log ("adding conversations...");
					      loadOpenConvs(body, offset, callback);   
				      }
				      else{
					      answer = answer.concat(data.conversationHistoryRecords);
					      offset = 0;
					      if(skillNumber === -1){
						     body = '{"start":{"from":' + start + ',"to":' + end + '}, "status": ["CLOSE"]';
					      }
					      else{
						       body = '{"start":{"from":' + start + ',"to":' + end + '}, "status": ["CLOSE"], "skillIds": ["' + skillNumber + '"]';
					      }
					      if(teamNumber){
						      body = body + ' ,"agentGroupIds":["' + teamNumber + '"]}';
					      }
					      else{
						      body = body + '}';
					      }
					      console.log(body);
					      loadClosedConvs(body, offset, callback);
				      }
				      
     
				      
                              },
                              error: function error(e, text) {
				      location.reload();
                              },
                              beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		});
	 }
	 
	 
	
	 loadOpenConvs(body, offset, function(err, resp) {
		 // Your code here...
	 });
	 
 }
 
 
 function downloadTranscripts(start, end, options){
	 
	 var conversationsToDownload = 0;
	 var conversationsPartial = 0;
	 var offset = 0;
	 var body = "";
	 var answer = [];
	 var exportObject = [];
	 
	 if (options === "Open"){ 
		 body = '{"start":{"from":' + start + ',"to":' + end + '},"status":["OPEN"]}'; 
	 }
	 else if (options === "Close"){
		 body = '{"start":{"from":' + start + ',"to":' + end + '},"status":["CLOSE"]}';	 
	 }
	 else if (options === "Open+Close"){
		 body = '{"start":{"from":' + start + ',"to":' + end + '}, "status":["OPEN","CLOSE"]}';	 
	 }
	 
	 function tryUntilSuccess(offset, callback) {
	 
	 	$.ajax({
                              url: "https://" + uri + "/messaging_history/api/account/" + accnumb + "/conversations/search?offset=" + offset + "&limit=100",
                              method: "POST",
                              jsonp: "cb",
                              jsonpCallback: "domainCallback",
                              cache: true,
                              contentType: "application/json",
                              data: body,
                              success: function success(data) {
				      if(offset == 0){
					      conversationsToDownload = data._metadata.count;
					      conversationsPartial = data.conversationHistoryRecords.length;
					      console.log(conversationsPartial + " of --> " + conversationsToDownload);      
				      }
				      if((data.conversationHistoryRecords.length) == 100){
					      offset = offset + 100;
					      answer = answer.concat(data.conversationHistoryRecords);
					      document.getElementById("reportMSG").innerHTML = "...downloading sessions:" + Math.round(100*(offset/data._metadata.count)) + "% completed...";
					      document.getElementById("reportMSG").style = "color : green";      
					      console.log(data.conversationHistoryRecords);
					      console.log(answer);
					      console.log ("adding conversations...");
					      // setTimeout(function(){
						      tryUntilSuccess(offset, callback);
					      // }, 1000);
				      }
				      else{
					      answer = answer.concat(data.conversationHistoryRecords);
					      console.log(answer);
					      console.log(answer.length);
					      document.getElementById("reportMSG").innerHTML = answer.length + " Messaging conversations downloaded with success!";
					      document.getElementById("reportMSG").style = "color : green";
					      for (var i = 0; i < (answer.length); i++){
						      var messages = "";
						      var thismessage = "";
						      var thisactor = "";
						      var endReason = "";
						      var length = answer[i].messageRecords.length;
						      for (var m = 0; m < length; m++){
							      var type = answer[i].messageRecords[m].type;
							      if(type === "TEXT_PLAIN"){
								   thismessage = answer[i].messageRecords[m].messageData.msg.text;
								   // thismessage = thismessage.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/, '**emoticon**');
								   // thismessage = thismessage.replace(/www./, '**link**');
								   // thismessage = thismessage.replace(/http/, '**link**');
								   thismessage = thismessage.replace(/[&\/\\#+$~%<>{}]/g,'%d');
							      }
							      else{
								   thismessage = "-structured content-";
							      }
							      thisactor = answer[i].messageRecords[m].sentBy;
							      messages = messages + "     " + thisactor + ": " + thismessage;
						      }
						      if(answer[i].info.endTime === -1){
							      endReason = "IN_PROGRESS";
						      }
						      else{
							      endReason = answer[i].info.closeReason;
						      }
						      
						      
						      var TimeAnswer = 0;
						      var whatTime = 0;
						      var firstTimeAnswer = "";
						      var isAnswered = 0;
						      var howManyMessages = answer[i].messageRecords.length;
						      if(howManyMessages){
							      if (answer[i].messageRecords[0].sentBy === "Consumer"){
								      whatTime = answer[i].messageRecords[0].timeL;
								      isAnswered = 0;
								      for (var n = 1; n < howManyMessages; n++){
									      if(answer[i].messageRecords[n].sentBy === "Agent"){
										      TimeAnswer = (answer[i].messageRecords[n].timeL - whatTime)/1000;
										      isAnswered = 1;
										      n = howManyMessages;
									      }
								      }
								      if (isAnswered){
									      firstTimeAnswer = secondsToString(TimeAnswer);
								      }
								      else{
									      firstTimeAnswer = "NOT_ANSWERED"
								      }
							      }
						      }
						      var phoneNumber = "";
						      if(answer[i].hasOwnProperty('sdes')){
							      if(answer[i].sdes.events[0].hasOwnProperty('customerInfo')){
								      phoneNumber = answer[i].sdes.events[0].customerInfo.customerInfo.imei;
							      }
							      else if(answer[i].sdes.events[0].hasOwnProperty('personalInfo')){
								      if(answer[i].sdes.events[0].personalInfo.personalInfo.contacts.length){
									      phoneNumber = answer[i].sdes.events[0].personalInfo.personalInfo.contacts[0].personalContact.phone;
								      }
							      }
						      }
						      
						      
						      
						      var timeToAccept = 0;
						      TimeAnswer = 0;
						      whatTime = 0;
						      isAnswered = 0;
						      howManyMessages = answer[i].messageRecords.length;
						      if(howManyMessages){
							      if (answer[i].messageRecords[0].sentBy === "Consumer"){
								      whatTime = answer[i].messageRecords[0].timeL;
								      if(answer[i].hasOwnProperty('agentParticipants') && answer[i].agentParticipants.length){
									      TimeAnswer = (answer[i].agentParticipants[0].timeL - whatTime)/1000;
									      isAnswered = 1;
								      }
								      if (isAnswered){
									      timeToAccept = secondsToString(TimeAnswer);
								      }
								      else{
									      timeToAccept = "NOT_ANSWERED"
								      }
							      }
						      }
						      
      
						      
						      var pieceToAdd = {"start": answer[i].info.startTime,"end": answer[i].info.endTime,"agent": answer[i].info.latestAgentNickname,"team": answer[i].info.latestAgentGroupName,"endReason": endReason,"timeToAccept": timeToAccept,"firstTimeAnswer": firstTimeAnswer,"phoneNumber": phoneNumber,"conversation": answer[i].info.conversationId,"transcript": messages};
						      exportObject = exportObject.concat(pieceToAdd);
					      }
				      	      console.log(exportObject);
					      if (exportObject.length > 0){
						      exportData(exportObject);
					      }
					      else{
						      document.getElementById("reportMSG").innerHTML = "I've not found any conversation in this period!";
						      document.getElementById("reportMSG").style = "color : red"; 
					      }
				      }
				      
     
				      
                              },
                              error: function error(e, text) {
				      document.getElementById("reportMSG").innerHTML = "System error. Please try again!";
				      document.getElementById("reportMSG").style = "color : red";  
                              },
                              beforeSend: function(xhr, settings) { xhr.setRequestHeader('Authorization','Bearer ' + bearer); }
		});
	 }
	 
	 tryUntilSuccess(offset, function(err, resp) {
		 // Your code here...
	 });
	 
	 
	 function exportData(exportObject){
		 testTypes = {
    			"start": "String",
    			"end": "String",
    			"agent": "String",
			"team": "String",
			"endReason": "String",
			"timeToAccept": "String",
			"firstTimeAnswer": "String",
			"phoneNumber": "String",
    			"conversation": "String",
    			"transcript": "String"
		 };
		 
		 emitXmlHeader = function () {
    			var headerRow =  '<ss:Row>\n';
    			for (var colName in testTypes) {
        			headerRow += '  <ss:Cell>\n';
        			headerRow += '    <ss:Data ss:Type="String">';
        			headerRow += colName + '</ss:Data>\n';
        			headerRow += '  </ss:Cell>\n';        
    			}
    			headerRow += '</ss:Row>\n';    
    			return '<?xml version="1.0"?>\n' +
           			'<ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">\n' +
           			'<ss:Worksheet ss:Name="Sheet1">\n' +
           			'<ss:Table>\n\n' + headerRow;
		};
		 
		 emitXmlFooter = function() {
    			return '\n</ss:Table>\n' +
           			'</ss:Worksheet>\n' +
           			'</ss:Workbook>\n';
		};
		 
		 jsonToSsXml = function (jsonObject) {
    			var row;
    			var col;
    			var xml;
    			var data = typeof jsonObject != "object" ? JSON.parse(jsonObject) : jsonObject;
    
    			xml = emitXmlHeader();
    			for (row = 0; row < data.length; row++) {
        			xml += '<ss:Row>\n';
      
        			for (col in data[row]) {
            				xml += '  <ss:Cell>\n';
            				xml += '    <ss:Data ss:Type="' + testTypes[col]  + '">';
            				xml += data[row][col] + '</ss:Data>\n';
            				xml += '  </ss:Cell>\n';
        			}
        			xml += '</ss:Row>\n';
    			}
    
    			xml += emitXmlFooter();
    			return xml;  
		};
		 
		 download = function (content, filename, contentType) {
    			if (!contentType) contentType = 'application/octet-stream';
    			var a = document.getElementById('hiddenbutton');
    			var blob = new Blob([content], {
        			'type': contentType
    			});
    			a.href = window.URL.createObjectURL(blob);
    			a.download = filename;
		};
		download(jsonToSsXml(exportObject), 'transcripts.xls', 'application/vnd.ms-excel');
		$("#hiddenbutton")[0].click();
		 
		 
	 }
	 
	 console.log(start + "****" + end + "****" + options);
	 
 }
   
    
</script>
    
    


</body>
</html>
